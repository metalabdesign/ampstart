{{!
<!---
Copyright 2016 The AMP Start Authors. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS-IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
}}

{{#footer}}
<section class="ampstart-travel__filter-bar">
  <div class="ampstart-travel__filter-bar__row">
    <div class="ampstart-travel__filter-bar__summary">
      <div>
        <button>Filters [V]</button>

        <span data-label>price</span>
        <span data-badge>
          <span [text]="fields_maxPrice_live ? 'Less than $' + round(fields_maxPrice_live) : '$800 or more'">$800 or more</span>
        </span>

        <span data-label>Type</span>
        <span data-badge>Active</span>
        <span data-badge>Nature</span>
        <span data-badge>Water</span>

        <span data-label>City</span>
        <span data-badge data-hollow>All cities</span>

        <div>[count] Tours &amp; Activities Found</div>
      </div>
      <div data-expand>
        <div data-grid>
          <div data-col>
            <div>MAX PRICE</div>
            <div>
              <span [text]="fields_maxPrice_live ? '$' + round(fields_maxPrice_live) : '$800+'">
                $800+
              </span>
            </div>
            <input
              type="range"
              name="maxPrice"
              step="1"
              min="1"
              max="801"
              value="801"
              [value]="fields_maxPrice == 0 ? 801 : fields_maxPrice"
              on="
                change:AMP.setState({
                  fields_maxPrice: event.value < event.max ? event.value : 0,
                  fields_maxPrice_live: event.value < event.max ? event.value : 0,
                  fields_maxPrice_edited: (event.value < event.max ? event.value : 0) != query_maxPrice
                });
                input-debounced:AMP.setState({
                  fields_maxPrice_live: event.value < event.max ? event.value : 0
                });
              "
            >
            <div>
              Average Price for activites in Mexico is
              between $30 and $100.
            </div>
          </div>
          <div data-col>
            <div>TYPE</div>
            <amp-selector
              layout="container"
              name="type"
              multiple
              on="
                select:AMP.setState({
                  fields_type: fields_type.includes(event.targetOption)
                    ? copyAndSplice(fields_type, fields_type.indexOf(event.targetOption), 1)
                    : fields_type.concat([event.targetOption]),
                  fields_type_edited: true
                })
              "
              [selected]="fields_type"
            >
              <div option="Active">Active</div>
              <div option="Artistic">Artistic</div>
              <div option="Drinks">Drinks</div>
              <div option="Fashion">Fashion</div>
              <div option="Food">Food</div>
              <div option="Music">Music</div>
              <div option="Nature">Nature</div>
              <div option="Nightlife">Nightlife</div>
              <div option="Tours">Tours</div>
              <div option="Water">Water</div>
            </amp-selector>
          </div>
          <div data-col>
            <div>CITY</div>
            <amp-list
              layout="nodisplay"
              height="200"
              src="/api/search?query=&departure=&return=&maxPrice=0&city=&type=&sort=Popular"
              [src]="
                '/api/search' +
                '?query=' + query_query +
                '&departure=' + query_departure +
                '&return=' + query_return +
                '&maxPrice=' + query_maxPrice +
                '&city=' + query_city.join('&city=') +
                '&type=' + query_type.join('&type=') +
                '&sort=' + query_sort
              "
              items="data"
            >
              <template type="amp-mustache">
                {{=[[ ]]=}}
                  <amp-selector
                    layout="container"
                    name="city"
                    multiple
                    on="
                      select:
                        AMP.setState({
                          fields_city: fields_city.includes(event.targetOption)
                            ? copyAndSplice(fields_city, fields_city.indexOf(event.targetOption), 1)
                            : fields_city.concat([event.targetOption]),
                          fields_city_edited: true
                        }),
                    "
                  >
                    {{#stats.cities}}
                      <!-- This should not be an error https://github.com/ampproject/amphtml/pull/9585 -->
                      {{#selected}}<div option="{{name}}" selected>{{/selected}}
                      {{^selected}}<div option="{{name}}">{{/selected}}
                        {{name}}
                      </div>
                    {{/stats.cities}}
                  </amp-selector>
                  <button overflow>SEE ALL CITIES</button>
                [[={{ }}=]]
              </template>
            </amp-list>
          </div>
        </div>
        <div>
          <button
            on="
              tap:AMP.setState({
                fields_maxPrice: query_maxPrice,
                fields_maxPrice_live: query_maxPrice,
                fields_maxPrice_edited: false,
                fields_city: query_city,
                fields_city_edited: false,
                fields_type: query_type,
                fields_type_edited: false
              })
            "
            disabled
            [disabled]="
              !fields_maxPrice_edited &&
              !fields_city_edited &&
              !fields_type_edited
            "
          >
            Reset Filters
          </button>
          <button
            on="
              tap:AMP.setState({
                viewIndex: 1,
                query_query: fields_query,
                fields_query_edited: false,
                query_departure: fields_departure,
                fields_departure_edited: false,
                query_return: fields_return,
                fields_return_edited: false,
                query_maxPrice: fields_maxPrice,
                fields_maxPrice_edited: false,
                query_city: fields_city,
                fields_city_edited: false,
                query_type: fields_type,
                fields_type_edited: false,
                query_sort: fields_sort,
                fields_sort_edited: false
              })
            "
            disabled
            [disabled]="
              !fields_maxPrice_edited &&
              !fields_city_edited &&
              !fields_type_edited
            "
          >
            Apply Filters
          </button>
        </div>
      </div>
    </div>
    <div class="ampstart-travel__filter-bar__sort">
      <div>
        Sort by <button>[SORT] [V]</button>
      </div>
      <div data-expand>
        <amp-selector
          layout="container"
          name="sort"
          on="
            select:AMP.setState({
              fields_sort: event.targetOption,
              fields_sort_edited: event.targetOption != query_sort
            })
          "
          [selected]="fields_sort"
        >
          <div option="Popular" selected>Popular</div>
          <div option="Best Rated">Best Rated</div>
          <div option="New">New</div>
          <div option="Lowest Price">Lowest Price</div>
        </amp-selector>
      </div>
    </div>
  </div>
</section>
{{/footer}}
