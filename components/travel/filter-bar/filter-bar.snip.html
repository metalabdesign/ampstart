{{!
<!---
Copyright 2016 The AMP Start Authors. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS-IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
}}

{{#footer}}
<section class="ampstart-travel__filter-bar">
  <div class="flex border-bottom mxn1 px1 md-px2">
    <div class="flex flex-auto border-right">
      <div class="px1 py2 nowrap">
        <span role="button">Filters [V]</span>
      </div>

      <div class="ellipsis-flex-parent px1">
        <div class="ellipsis py2">
          <span data-label>Price</span>&nbsp;
          <span class="badge">
            <span [text]="fields_maxPrice_live < 801 ? 'Up to $' + round(fields_maxPrice_live) : 'Any price'">Any price</span>
          </span>
        </div>
      </div>

      <div class="ellipsis-flex-parent px1">
        <div class="ellipsis py2">
          <span data-label>Type</span>&nbsp;
          <span
            class="badge"
            [class]="'badge' + (fields_type.length > 0 && fields_type.length < {{data.types.length}} ? ' hide' : '')"
          >All types</span>

          {{#data.types}}
            <span
              class="badge hide"
              [class]="'badge' + (fields_type.includes('{{value}}') ? '' : ' hide')"
            >{{text}}</span><span
              class="hide"
              [class]="(fields_type.includes('{{value}}') ? '' : ' hide')"
            >&nbsp;</span>
          {{/data.types}}
        </div>
      </div>

      <div class="flex-auto ellipsis-flex-parent px1">
        <div class="ellipsis py2">
          <span data-label>City</span>&nbsp;
          <amp-list
            class="inline-list"
            layout="flex-item"
            {{> ../util/list-src.snip.html}}
          >
            <template type="amp-mustache">
              {{=[[ ]]=}}
              {{#stats.allCities}}<span class="badge">All cities</span>{{/stats.allCities}}
              {{^stats.allCities}}
              {{#stats.cities}}
                {{#selected}}<span class="badge">{{name}}</span>&nbsp;{{/selected}}
              {{/stats.cities}}
              {{/stats.allCities}}
              [[={{ }}=]]
            </template>
          </amp-list>
        </div>
      </div>

      <div class="ellipsis-flex-parent px1 md-pr2">
        <div class="ellipsis py2">
          <amp-list
            class="inline-list"
            layout="flex-item"
            {{> ../util/list-src.snip.html}}
          >
            <template type="amp-mustache">
              {{=[[ ]]=}}
              <span>{{stats.resultCount}} <span class="sm-hide xs-hide">Tours &amp; Activities</span> Found</span>
              [[={{ }}=]]
            </template>
          </amp-list>
        </div>
      </div>
    </div>

    <div class="px1 py2 md-pl2 nowrap">
      Sort by
      <span role="button">
        {{#data.sort}}
          <span {{^selected}}class="hide"{{/selected}} [class]="fields_sort == '{{value}}' ? '' : 'hide'">
            {{text}}
          </span>
        {{/data.sort}}
        [V]
      </span>
    </div>
  </div>


  <!-- Filter pane -->
  <div>
    <div class="container px1">
      <div class="clearfix mxn2">
        <div class="col col-4 px2">
          <div>MAX PRICE</div>
          <div>
            <span [text]="fields_maxPrice_live < 801 ? '$' + round(fields_maxPrice_live) : '$800+'">
              $800+
            </span>
          </div>
          <svg width="100%" viewBox="0 0 800 100">
            <defs>
              <linearGradient x1="0" y1="0" x2="0" y2="120%" id="price-gradient">
                <stop offset="0%" stop-color="currentColor"></stop>
                <stop offset="200%" stop-color="#FFF"></stop>
              </linearGradient>
            </defs>
            <path fill="url(#price-gradient)" d="m0,100 S12.5 100,25 100 S62.5 91.477,75 82.955 S112.5 64.204,125 62.5 S162.5 55.966,175 52.841 S212.5 41.477,225 36.364 S262.5 28.125,275 30.113 S312.5 43.466,325 52.841 S362.5 76.421,375 81.25 S412.5 85.227,425 79.546 S462.5 51.137,475 34.091 S512.5 1.421,525 2.841 S562.5 15.057,575 24.432 S612.5 45.881,625 48.579 S662.5 56.108,675 58.239 S712.5 71.875,725 81.25 S762.5 100,775 100 S800 100,800 100"></path>
          </svg>
          <input
            type="range"
            name="maxPrice"
            step="1"
            min="1"
            max="801"
            value="801"
            [value]="'' + fields_maxPrice"
            on="
              change:AMP.setState({
                fields_maxPrice: event.value,
                fields_maxPrice_live: event.value,
                fields_maxPrice_edited: event.value != query_maxPrice
              });
              input-debounced:AMP.setState({
                fields_maxPrice_live: event.value
              });
            "
          >
          <div>
            Average Price for activites in Mexico is
            between $30 and $100.
          </div>
        </div>
        <div class="col col-4 px2">
          <div>TYPE</div>
          <amp-selector
            layout="container"
            name="type"
            multiple
            on="
              select:AMP.setState({
                fields_type: fields_type.includes(event.targetOption)
                  ? copyAndSplice(fields_type, fields_type.indexOf(event.targetOption), 1)
                  : fields_type.concat([event.targetOption]),
                fields_type_edited: true
              })
            "
            [selected]="fields_type"
          >
            {{#data.types}}
              <div option="{{value}}">{{text}}</div>
            {{/data.types}}
          </amp-selector>
        </div>
        <div class="col col-4 px2">
          <div>CITY</div>
          <amp-list
            class="block-list"
            layout="flex-item"
            {{> ../util/list-src.snip.html}}
          >
            <template type="amp-mustache">
              {{=[[ ]]=}}
                <amp-selector
                  layout="container"
                  name="city"
                  multiple
                  on="
                    select:
                      AMP.setState({
                        fields_city: fields_city.includes(event.targetOption)
                          ? copyAndSplice(fields_city, fields_city.indexOf(event.targetOption), 1)
                          : fields_city.concat([event.targetOption]),
                        fields_city_edited: true
                      })
                  "
                >
                  {{#stats.cities}}
                    <!-- This should not be an error https://github.com/ampproject/amphtml/pull/9585 -->
                    {{#selected}}<div option="{{name}}" selected>{{/selected}}
                    {{^selected}}<div option="{{name}}">{{/selected}}
                      {{name}}
                    </div>
                  {{/stats.cities}}
                </amp-selector>
              [[={{ }}=]]
            </template>
          </amp-list>
        </div>
      </div>
    </div>
    <div>
      <button
        on="
          tap:AMP.setState({
            fields_maxPrice: query_maxPrice,
            fields_maxPrice_live: query_maxPrice,
            fields_maxPrice_edited: false,
            fields_city: query_city,
            fields_city_edited: false,
            fields_type: query_type,
            fields_type_edited: false
          })
        "
        disabled
        [disabled]="
          !fields_maxPrice_edited &&
          !fields_city_edited &&
          !fields_type_edited
        "
      >
        Reset Filters
      </button>
      <button
        on="
          tap:AMP.setState({
            viewIndex: 1,
            query_query: fields_query,
            fields_query_edited: false,
            query_departure: fields_departure,
            fields_departure_edited: false,
            query_return: fields_return,
            fields_return_edited: false,
            query_maxPrice: fields_maxPrice,
            fields_maxPrice_edited: false,
            query_city: fields_city,
            fields_city_edited: false,
            query_type: fields_type,
            fields_type_edited: false,
            query_sort: fields_sort,
            fields_sort_edited: false
          })
        "
        disabled
        [disabled]="
          !fields_maxPrice_edited &&
          !fields_city_edited &&
          !fields_type_edited
        "
      >
        Apply Filters
      </button>
    </div>
  </div>
  <!--/ Filter pane -->


  <!-- Sort pane -->
  <div>
    <amp-selector
      layout="container"
      name="sort"
      on="
        select:AMP.setState({
          fields_sort: event.targetOption,
          fields_sort_edited: event.targetOption != query_sort
        })
      "
      [selected]="fields_sort"
    >
      {{#data.sort}}
        <div option="{{value}}"{{#selected}} selected{{/selected}}>{{text}}</div>
      {{/data.sort}}
    </amp-selector>
  </div>
  <!--/ Sort pane -->

</section>
{{/footer}}
