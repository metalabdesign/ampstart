<!doctype html>

<!---
Copyright 2017 The AMP Start Authors. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS-IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

{{#gallery}}
<html âš¡>
  {{> ../utils/amp-page-head.snip.html}}
  <body>
    <main id="content" class="ampstart-gallery-fill" role="main">
      <amp-iframe
        class="ampstart-gallery-fill"
        layout="fill"
        sandbox="allow-scripts allow-top-navigation"
        scrolling="no"
        frameborder="0"
        src="gallery-vr.amp.html"
      >
        <div placeholder></div>
      </amp-iframe>
      <div class="ampstart-gallery-title">
        Toronto Museum of Contemporary Art
      </div>
    </main>
<script type="text/javascript">
(function() {
  'use strict';

  var orientationListeners = [];

  window.addEventListener('message', function (event) {
    if (
      event.data &&
      event.data.sentinel === 'amp' &&
      event.data.type === 'send-device-orientation'
    ) {
      orientationListeners.push(event.source);
    }
  });

  window.addEventListener('deviceorientation', function (event) {
    var orientation;

    if (window.orientation !== undefined) {
      orientation = window.orientation ;
    } else if (typeof event.gamma === 'number') {
      orientation = (Math.round(event.gamma / 90) * 90) || 0;
    }

    var message = {
      sentinel: 'amp',
      type: 'device-orientation',
      orientation: orientation,
      alpha: event.alpha,
      beta: event.beta,
      gamma: event.gamma,
    };

    for (var i = 0, len = orientationListeners.length; i < len; i++) {
      orientationListeners[i].postMessage(message, '*');
    }
  });
})();

</script>
  </body>
</html>
{{/gallery}}
