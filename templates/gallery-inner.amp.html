<!doctype html>

<!---
Copyright 2017 The AMP Start Authors. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS-IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

{{#gallery}}
<html âš¡>
  {{> ../utils/amp-page-head.snip.html}}
  <body>
    <header class="ampstart-gallery-base-header ampstart-gallery-base-invert">
      <div class="ampstart-gallery-base-header-menu-button" role="button"></div>
      <div class="ampstart-gallery-base-header-rotate">
        <div class="ampstart-gallery-base-heading">
          Toronto Museum of Contemporary Art
        </div>
      </div>
    </header>
    <main id="content" role="main" style="height: 400vh; background: #fff">
      <header class="ampstart-gallery-inner-header clearfix">
        <div class="ampstart-gallery-base-container">
          <div class="ampstart-gallery-inner-header-content">
            <h1
              device-parallax="100"
              class="ampstart-gallery-inner-header-heading"
            >
              L'Arbre Blanc
            </h1>
            <div
              device-parallax="100"
              class="ampstart-gallery-inner-header-subheading"
            >
              <time datetime="2017-08-24">Sept 24</time>-<time datetime="2017-08-29">29</time> / Sou Fujimoto
            </div>
            <div
              device-parallax="150"
              class="ampstart-gallery-inner-header-action"
            >
              <div class="ampstart-gallery-base-button" role="Button">
                Buy Tickets
              </div>
            </div>
          </div>
        </div>
        <div
          device-parallax="100"
          class="ampstart-gallery-inner-header-carousel"
        >
          <amp-carousel
            controls
            height="316"
            layout="fixed-height"
            type="carousel"
          >
            <amp-img
              src="https://unsplash.it/472/316/?image=1081"
              width="472"
              height="316"
            ></amp-img>
            <amp-img
              src="https://unsplash.it/472/316/?image=1052"
              width="472"
              height="316"
            ></amp-img>
            <amp-img
              src="https://unsplash.it/472/316/?image=954"
              width="472"
              height="316"
            ></amp-img>
            <amp-img
              src="https://unsplash.it/472/316/?image=949"
              width="472"
              height="316"
            ></amp-img>
            <amp-img
              src="https://unsplash.it/472/316/?image=830"
              width="472"
              height="316"
            ></amp-img>
            <amp-img
              src="https://unsplash.it/472/316/?image=334"
              width="472"
              height="316"
            ></amp-img>
          </amp-carousel>
        </div>
      </header>
      <section>
        <div class="ampstart-gallery-base-container">
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <h3 device-parallax="75">parallax</h3>
          <h2 device-parallax="150">parallax</h2>
          <h1 device-parallax="200">parallax</h1>
          <h2 device-parallax="150">parallax</h2>
          <h3 device-parallax="75">parallax</h3>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
          <p>content</p>
        </div>
      </section>
    </main>
<script type="text/javascript">
  // (function () {
  //   'use-strict';
  //   var src = 'https://cdn.ampproject.org/v0.js';
  //   var script = document.querySelector('script[src="' + src + '"');

  //   var experiments = [
  //     'amp-fx-parallax',
  //   ];

  //   script.addEventListener('load', function() {
  //     for (var i = 0, len = experiments.length; i < len; i++) {
  //       if (!AMP.isExperimentOn(experiments[i])) {
  //         console.log('enable ' + experiments[i])
  //         AMP.toggleExperiment(experiments[i]);
  //       }
  //     }
  //   });
  // })();

  (function () {
    'use-strict';
    var motionScale = 10;
    var scrollScale = 0.2;
    var motionRange = 20;
    var filterRate = 0.15;
    var motionDamping = 0.80;

    var accelerationX = 0;
    var accelerationY = 0;

    var motionX = 0;
    var motionY = 0;

    var updateRequest = null;
    var parallaxElements;
    var parallaxFactor;

    function clamp(min, max, number) {
      return Math.min(max, Math.max(min, number));
    }

    function applyUpdate() {
      var i, len, element, range, motionTransformX, motionTransformY,
        rect, progressX, progressY, scrollTransformX, scrollTransformY;

      var docWidth = window.document.documentElement.clientWidth;
      var docHeight = window.document.documentElement.clientHeight;

      var bodyWidth = window.document.body.clientWidth;
      var bodyHeight = window.document.body.clientHeight;

      var vmin = Math.min(docWidth, docHeight);

      for (i = 0, len = parallaxElements.length; i < len; i++) {
        element = parallaxElements[i].element;
        range = parallaxElements[i].range;

        motionTransformX = range * motionScale *
          clamp(-motionRange * 0.5, motionRange * 0.5, motionX) / motionRange;

        motionTransformY = range * motionScale *
          clamp(-motionRange * 0.5, motionRange * 0.5, -motionY) / motionRange;

        rect = element.getBoundingClientRect();

        if (bodyWidth > docWidth) {
          // var xRange =
          progressX = clamp(0, 1, rect.left / (docWidth + rect.width)) - 0.5;
          scrollTransformX = range * -progressX;
        } else {
          scrollTransformX = 0;
        }

        if (bodyHeight > docHeight) {
          var rangeY = Math.min(docHeight + rect.height, 2 * (rect.bottom + document.body.scrollTop))
          progressY = clamp(0, 1, rect.bottom / rangeY) - 0.5;
          scrollTransformY = range * progressY;
        } else {
          scrollTransformY = 0;
        }

        element.style.transform = 'translate3d(' +
          (motionTransformX + scrollTransformX) + 'px, ' +
          (motionTransformY + scrollTransformY) + 'px, ' +
        '0)';
      }
    }

    function queueUpdate() {
      if (updateRequest) {
        window.cancelAnimationFrame(updateRequest);
      }

      window.requestAnimationFrame(applyUpdate)
    }

    function graph(val, id) {
      var node = document.getElementById(id);

      if (val < 0) {
        node.style.left = (50 - Math.abs(val)).toFixed(3) + '%';
        node.style.right = '50%';
      } else {
        node.style.left = '50%';
        node.style.right = (50 - Math.abs(val)).toFixed(3) + '%';
      }
    }

    function initialize() {
      parallaxElements = [].map.call(
        window.document.querySelectorAll('[device-parallax]'),
        function(element) {
          return {
            element: element,
            range: parseFloat(element.getAttribute('device-parallax'))
          };
        }
      );


      if (parallaxElements.length) {
        window.addEventListener('devicemotion', function(event) {
          accelerationX = filterRate * event.acceleration.x + (1 - filterRate) * accelerationX;
          accelerationY = filterRate * event.acceleration.y + (1 - filterRate) * accelerationY;

          motionX += accelerationX * event.interval;
          motionY += accelerationY * event.interval;

          motionX *= motionDamping;
          motionY *= motionDamping;

          queueUpdate();
        });

        window.addEventListener('scroll', function() {
          queueUpdate();
        });

        window.addEventListener('resize', function() {
          queueUpdate();
        });

        queueUpdate();
      }
    }

    initialize();
  })();
</script>
  </body>
</html>
{{/gallery}}
